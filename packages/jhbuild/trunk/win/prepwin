#!/bin/sh

mydir=`dirname "$0"`
makefile="$mydir/makefiles/$1"
srcdir="$2"
prefix="$3"

set -e

# Copy MSBuild makefile
cp $mydir/make.msbuild .

# Store configuration environment so make.msbuild can load it
cat > make.env <<E_O_F
SRCDIR = $srcdir
WORKDIR = `pwd -W`
PREFIX = $prefix
BINDIR = $prefix/bin
INCLUDEDIR = $prefix/include
LIBDIR = $prefix/lib

MSBUILD_ARCH = Win32

ifeq (\$(MSBUILD_ARCH),x64)
MACHINE = x64
else
MACHINE = x86
endif
E_O_F

# Copy package specific files (including Makefile)
if [ -f "$makefile" ]; then
    cp -f "$makefile" make.win
fi

# Rename GNU standard INSTALL file so make install will not find it
[ -f INSTALL ] && mv INSTALL INSTALL.TXT

exit 0
